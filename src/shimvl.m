function [mfp logTdata] = shimvl (T, E)
%%SHIMVL mm Pb to get a given attenuation
%
% Data taken from A. Shimizu et al., 2004, J. Nuc Sci Tech, 41, 413.

if ~all(0.03 <= E & E <= 15.0), error('E (%g) out of range in SHIMIZUVL',E); end
if ~all(0.0 <= T & T <= 1.0), error('T (%g) out of range in SHIMIZUVL',T); end

shimizuTable4 = [ ...
  Inf,0.03,0.04,0.05,0.06,0.08,0.088,0.089,0.09,0.1,0.11,0.12,0.13,0.14,0.15,0.16,0.2,0.3,0.4,0.5,0.6,0.8,1,1.5,2,3,4,5,6,8,10,15; ...
  0.5,1,1.01,1.01,1.02,1.03,1.04,1.69,1.68,1.6,1.51,1.44,1.38,1.33,1.29,1.25,1.16,1.07,1.1,1.13,1.15,1.18,1.2,1.23,1.25,1.25,1.25,1.25,1.27,1.29,1.32,1.39; ...
  1,1.01,1.01,1.02,1.03,1.05,1.06,2.38,2.36,2.15,1.94,1.77,1.64,1.52,1.44,1.36,1.2,1.11,1.17,1.22,1.27,1.33,1.37,1.43,1.45,1.43,1.42,1.42,1.44,1.49,1.55,1.71; ...
  2,1.01,1.02,1.03,1.04,1.07,1.08,4.25,4.16,3.47,2.85,2.39,2.04,1.78,1.6,1.46,1.23,1.18,1.28,1.38,1.46,1.59,1.67,1.79,1.83,1.8,1.76,1.75,1.77,1.86,2,2.42; ...
  3,1.01,1.02,1.03,1.05,1.09,1.1,7.51,7.28,5.48,4.06,3.08,2.41,1.97,1.69,1.51,1.25,1.223,1.36,1.5,1.62,1.81,1.95,2.15,2.22,2.19,2.12,2.1,2.13,2.27,2.51,3.31; ...
  4,1.01,1.02,1.04,1.05,1.1,1.12,13.6,13,8.79,5.8,3.93,2.8,2.13,1.75,1.53,1.27,1.27,1.43,1.61,1.77,2.02,2.2,2.49,2.61,2.6,2.52,2.5,2.54,2.75,3.13,4.5; ...
  5,1.01,1.02,1.04,1.06,1.11,1.13,25.4,24,14.5,8.46,5.08,3.24,2.28,1.79,1.54,1.28,1.3,1.5,1.7,1.9,2.21,2.44,2.83,3.02,3.03,2.96,2.93,3,3.31,3.89,6.09; ...
  6,1.01,1.02,1.04,1.06,1.12,1.14,48.3,45.2,24.4,12.6,6.67,3.77,2.44,1.83,1.55,1.3,1.33,1.55,1.78,2.01,2.38,2.67,3.17,3.42,3.49,3.43,3.42,3.53,3.98,4.82,8.25; ...
  7,1.01,1.03,1.04,1.07,1.12,1.15,93.5,86.5,42.2,19.4,8.96,4.46,2.61,1.87,1.56,1.31,1.36,1.6,1.86,2.12,2.55,2.9,3.5,3.84,3.98,3.95,3.97,4.12,4.76,5.97,11.2; ...
  8,1.01,1.03,1.05,1.07,1.13,1.16,183,168,74,30.3,12.3,5.35,2.81,1.9,1.57,1.32,1.38,1.64,1.94,2.23,2.71,3.11,3.83,4.27,4.49,4.51,4.58,4.8,5.7,7.4,15.2; ...
  10,1.01,1.03,1.05,1.07,1.14,1.17,720,647,237,78.7,24.9,8.19,3.34,1.98,1.58,1.34,1.42,1.72,2.07,2.42,3.01,3.52,4.48,5.13,5.59,5.76,5.99,6.45,8.12,11.4,28.3; ...
  ];


logEs = log(shimizuTable4(1,2:end));
mfps = shimizuTable4(2:end,1);
buildupFactors = shimizuTable4(2:end,2:end);
logTdata = log(bsxfun(@(x,y) x.*y, exp(-mfps), buildupFactors));

e = find(log(E) < logEs, 1) - 1;
t = find(log(T) > logTdata(:,e), 1) - 1;
% fprintf('Bracketing result:\n');
% fprintf('T: %g > %g >= %g\n', logTdata(t,e), log(T), logTdata(t+1,e));
% fprintf('E: %g <= %g < %g\n',logEs(e), log(E), logEs(e+1));

Tte = logTdata(t,e);
Tte1 = logTdata(t,e+1);
Tt1e = logTdata(t+1,e);
Tt1e1 = logTdata(t+1,e+1);

% now that we've bracketed the thickness, first interpolate along energy axis
Tl = (Tte1 - Tte)   * (log(E) - logEs(e)) / (logEs(e+1) - logEs(e)) + Tte;
Th = (Tt1e1 - Tt1e) * (log(E) - logEs(e)) / (logEs(e+1) - logEs(e)) + Tt1e;

% now solve for mfp
%log(T) = (Tt1 - Tt) * (mfp - mfps(t)) / ...
%  (Tdata(t+1,e) - Tdata(t,e)) + Tt;

mfp = (log(T) - Tl) * (mfps(t+1) - mfps(t)) / (Th - Tl) + mfps(t);